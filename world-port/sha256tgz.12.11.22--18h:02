#!/bin/sh -eu

tarpath="$1"
PATH="/usr/bin:/usr/sbin:${PATH}"

FILEHASH=$(tar tf ${tarpath} | grep -v '/$' | sort | xargs -L1 sh -c "PATH=${PATH}; sha256 \$1;stat -f %g%u%T%p" | sha256)
DIRHASH=$(cd $dir_path && find . -type d | sort | xargs -L1 xargs -L1 stat -f %g%u%T%p | sha256)

RESULTHASH=$(echo ${DIRHASH}${FILEHASH} | sha256)

printf "SHA256DIR (${1%%/}/) = ${RESULTHASH}\n"
